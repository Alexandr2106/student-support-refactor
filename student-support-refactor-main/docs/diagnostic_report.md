# Диагностическая записка  
**Проект:** Система обработки обращений студентов  
**Анализируемый компонент:** `RequestProcessor.process()`  

## A) Смешанные ответственности

Метод `process` нарушает принцип единственной ответственности (SRP). Он совмещает как минимум **семь различных причин для изменения**:

1. **Валидация входных данных** — правила проверки `studentId`, `topic`, `text` могут ужесточиться или ослабнуть.
2. **Работа с хранилищем данных** — логика сохранения и проверки дубликатов зависит от конкретной СУБД и схемы.
3. **Журналирование событий** — формат сообщений, уровень детализации, место записи (файл, syslog, cloud) могут меняться независимо.
4. **Отправка уведомлений** — поддержка новых каналов (SMS, Telegram, внутренний чат) требует модификации метода.
5. **Формирование ответа студенту** — бизнес-правила по темам (`password`, `schedule`) эволюционируют отдельно от остальной логики.
6. **Обработка флага срочности** — политика реакции на `urgentFlag` может расшириться (например, эскалация вручную).
7. **Конфигурирование инфраструктуры** — параметры подключения к БД, SMTP, API мессенджера не относятся к доменной логике.

Любое изменение в одной из этих областей **вынуждает пересматривать весь метод**, повышая риск регрессий.

## B) Анализ связности и сцепления

### Жёсткие зависимости
Метод создаёт объекты напрямую:
- `new DatabaseClient("jdbc:...", "user", "pass")`
- `new FileLogger("c:/logs/app.log")`
- `new SmtpClient("smtp.server", 25)`
- `new MessengerApiClient("token123")`

Эти зависимости:
- **Невозможно подменить** без изменения кода.
- **Связывают доменную логику с инфраструктурой**: путь к логу (`c:/...`) делает код непереносимым, креды в коде — угроза безопасности.
- **Приводят к высокой связанности**: замена SMTP-провайдера требует правки в ядре бизнес-логики.

### «Утечка» деталей реализации
- SQL-запросы в виде строк → уязвимость к инъекциям, зависимость от диалекта SQL.
- Конкретные строки конфигурации (порт 25, токен `"token123"`) находятся внутри метода → нарушение инкапсуляции.

Сцепление (cohesion) низкое: метод объединяет разнородные задачи, не связанные семантически.

## C) Диагностика тестируемости

Модульное тестирование метода `process` **невозможно** по следующим причинам:

1. **Создание зависимостей внутри метода** — нельзя внедрить моки для `DatabaseClient` или `SmtpClient`.
2. **Реальные побочные эффекты** — при вызове метода происходит запись в файл и сетевые запросы, что делает тесты:
   - медленными,
   - зависящими от внешней среды (доступность SMTP, права на запись в `C:\logs`),
   - недетерминированными.
3. **Отсутствие контрактов** — нет интерфейсов, по которым можно было бы определить ожидаемое поведение зависимостей.
4. **Смешение чистых и грязных операций** — логика принятия решений (чистая) неразрывно связана с I/O (грязным).

Тест такого метода будет **интеграционным по сути**, даже если написан как unit-тест.

## D) Точки изменчивости

Выявлено **пять ключевых точек изменчивости**, которые будут меняться чаще всего:

1. **Каналы уведомлений** — например, добавление WhatsApp-бота.
2. **Политика обработки дубликатов** — например, разрешить повторные обращения через 24 часа.
3. **Правила формирования ответа** — например, новые темы: «стипендия», «пересдача».
4. **Стратегия аудита и логирования** — например, отправка событий в SIEM-систему.
5. **Хранилище обращений** — например, переход с SQL на документную базу данных.

Эти точки должны быть **изолированы** от основной логики обработки.
